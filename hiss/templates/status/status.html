{% extends 'dashboard_base.html' %}
{% load static tz %}

{% block content %}
{% get_current_timezone as TIME_ZONE %}

<article class="status-card text-center">
    <header>
        <ol class="status-timeline">
            <li>
                {% if CONFIRMED or REJECTED or PENDING or NEEDS_TO_CONFIRM or DECLINED %}
                    <span class="point-complete"><img src="{% static 'tick.svg' %}" alt="Complete"></span>
                {% else %}
                    <span class="point"></span>
                {% endif %}
                <span class="label">Submitted</span>
            </li>
            <li>
                {% if CONFIRMED or REJECTED or NEEDS_TO_CONFIRM or WAIT_UNTIL_NEXT_WAVE or DECLINED %}
                    <span class="point-complete"><img src="{% static 'tick.svg' %}" alt="Complete"></span>
                {% else %}
                    <span class="point"></span>
                {% endif %}
                <span class="label">In Review</span>
            </li>
            <li>
                {% if CONFIRMED or REJECTED or NEEDS_TO_CONFIRM or DECLINED %}
                    <span class="point-complete"><img src="{% static 'tick.svg' %}" alt="Complete"></span>
                {% else %}
                    <span class="point"></span>
                {% endif %}
                <span class="label">Decisions Released</span>
            </li>
            {% if CONFIRMED or NEEDS_TO_CONFIRM or DECLINED %}
            <li>
                {% if CONFIRMED or DECLINED %}
                    <span class="point-complete"><img src="{% static 'tick.svg' %}" alt="Complete"></span>
                {% else %}
                    <span class="point"></span>
                {% endif %}
                <span class="label">RSVP</span>
            </li>
            {% endif %}
        </ol>
    </header>

    {% if NOT_APPLIED %}
        <p class="status-label">Your application is</p>
        <p class="status-value">INCOMPLETE</p>
        <p class="status-description">
            Submit your application before {{ active_wave_end }} {{ TIME_ZONE }} to be considered.
            Don't worry, though! You can still apply as a walk-in, but your spot is not guaranteed.
        </p>
        <div class="status-actions">
            <a href="{% url 'application:create' %}" role="button" class="btn-primary">Complete Application</a>
        </div>

    {% elif PENDING %}
        <p class="status-label">Your application has been</p>
        <p class="status-value">SUBMITTED</p>
        <p class="status-description">
            Thanks for applying! We'll email you as soon as decisions are released.
        </p>
        <div class="status-actions">
            <a href="{{ application.get_absolute_url }}" role="button" class="btn-primary">
                {% if active_wave_end %}Edit Application{% else %}View Application{% endif %}
            </a>
        </div>

    {% elif NEEDS_TO_CONFIRM and not DECLINED %}
        <p class="status-label">Congrats, you have been</p>
        <p class="status-value">ACCEPTED</p>
        <p class="status-description">
            Please RSVP below by <strong>October 16th, 2025, at 11:59PM</strong> or you risk losing your spot.
        </p>

        <form method="POST" action="{% url 'rsvp_submit' pk=application.pk %}" class="rsvp-form">
            {% csrf_token %}
            {% for field in rsvp_form %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}" {% if field.field.required %}class="required-form-input"{% endif %}>
                        {{ field.label }}
                    </label>
                    {{ field }}
                    {% if field.help_text %}
                        <small>{{ field.help_text }}</small>
                    {% endif %}
                    {% if field.errors %}
                        <small class="error">{{ field.errors }}</small>
                    {% endif %}
                </div>
            {% endfor %}

            <div class="status-actions">
                <a href="{% url 'application:decline' pk=application.pk %}" 
                   onclick="event.preventDefault(); document.getElementById('decline-form').submit();" 
                   class="btn-secondary">No, I will NOT participate.</a>
                <button type="submit" class="btn-primary">I'll be there!</button>
            </div>
        </form>

        <form id="decline-form" method="POST" action="{% url 'application:decline' pk=application.pk %}" style="display: none;">
            {% csrf_token %}
        </form>

    {% elif CONFIRMED %}
        <p class="status-label">Your attendance has been</p>
        <p class="status-value">CONFIRMED</p>
        <p class="status-description">
            Prepare for the event by visiting our FAQ for tips and info. See you soon!
        </p>
        <p class="status-description">
            You will receive an email in the coming days containing more information about the event, as well the QR code necessary for checking in.
        </p>
        <p class="status-description">
            Have additional questions? Email us at <a href="mailto:{{ organizer_email }}">{{ organizer_email }}</a>.
        </p>

    {% elif REJECTED %}
        <p class="status-label">Your application status is</p>
        <p class="status-value">REJECTED</p>
        <p class="status-description">
            Unfortunately, you have not been admitted into the event.
        </p>
        <div class="status-actions">
            <a href="{{ application.get_absolute_url }}" role="button" class="btn-primary">View Application</a>
        </div>

    {% elif DECLINED %}
        <p class="status-value">Not Attending</p>
        <p class="status-description">We're sorry to hear you can't make it! Thanks for telling us!</p>

    {% elif NO_MORE_WAVES %}
        <p class="status-description">Sorry, we are currently not accepting applications.</p>

    {% elif EXPIRED %}
        <p class="status-label">Your application is</p>
        <p class="status-value">WAITLISTED</p>
        <p class="status-description">
            Your admittance to the hackathon is not guaranteed, but you still may be able to attend if we have capacity. We will have a waitlist line for students who are not accepted. Starting at 10AM, we will admit people from the waitlist line until the MSC capacity has been reached. You can read our full waitlist policy on the {{ event_name }} live site.
        </p>
        <p class="status-description">
            In the event that you do choose to attend, prepare for the event by visiting our FAQ for tips and info. See you soon!
        </p>
        <p class="status-description">
            You will receive an email shortly containing more information about the event, as well the QR code necessary for checking in.
        </p>
        <p class="status-description">
            Have additional questions? Email us at <a href="mailto:{{ organizer_email }}">{{ organizer_email }}</a>.
        </p>
    {% endif %}
</article>
{% endblock %}
